<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3321px" preserveAspectRatio="none" style="width:2844px;height:3321px;" version="1.1" viewBox="0 0 2844 3321" width="2844px" zoomAndPan="magnify"><defs><filter height="300%" id="f96s0w8" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="1342" y="23.1318">DID Exchange Protocol</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="855" x2="855" y1="68.1973" y2="3283.7378"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1058.5" x2="1058.5" y1="68.1973" y2="3283.7378"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1244.5" x2="1244.5" y1="68.1973" y2="3283.7378"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1431" x2="1431" y1="68.1973" y2="3283.7378"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1678.5" x2="1678.5" y1="68.1973" y2="3283.7378"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2029" x2="2029" y1="68.1973" y2="3283.7378"/><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="831" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="838" y="53.2305">Alice</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="831" y="3282.7378"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="838" y="3302.8696">Alice</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="1009.5" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1016.5" y="53.2305">Alice Agency</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="1009.5" y="3282.7378"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1016.5" y="3302.8696">Alice Agency</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="1200.5" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1207.5" y="53.2305">Alice Agent</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="1200.5" y="3282.7378"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1207.5" y="3302.8696">Alice Agent</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="1358" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1365" y="53.2305">Alice Pairwise Agent</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="1358" y="3282.7378"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1365" y="3302.8696">Alice Pairwise Agent</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="1657.5" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="1664.5" y="53.2305">Bob</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="1657.5" y="3282.7378"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="1664.5" y="3302.8696">Bob</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="1987" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1994" y="53.2305">Bob Agent</text><rect fill="#FEFECE" filter="url(#f96s0w8)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="1987" y="3282.7378"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1994" y="3302.8696">Bob Agent</text><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2836" x="3" y="98.6716"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="98.6716" y2="98.6716"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="101.6716" y2="101.6716"/><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="98" x="1372" y="88.1973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="1378" y="104.3911">Provisioning</text><polygon fill="#A80036" points="1047,291.6333,1057,295.6333,1047,299.6333,1051,295.6333" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="1053" y1="295.6333" y2="295.6333"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="862" y="291.8271">Provision Alice</text><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="193,126.146,193,449.146,846,449.146,846,136.146,836,126.146,193,126.146" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="836" x2="836" y1="126.146" y2="136.146"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="836" y1="136.146" y2="136.146"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="199" y="143.3398">Agency side:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="211" y="158.2886">We can keep the common workflow as is.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="211" y="173.2373">We still can create Pairwise Agents on the initiation of connection or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="243" y="188.186">accepting an invitation but use it as a mediator only.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="211" y="203.1348">In the current state Pairwise Agents are already able</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="227" y="218.0835">- collect incoming messages</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="227" y="233.0322">- return collected messages</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="227" y="247.981">- update status of received messages</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="203" y="262.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="632" x="199" y="277.8784">The key difference is that we will not use Agency anymore for sending messages to another connection side,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329" x="227" y="292.8271">so we don't need to keep other side keys on the Agency.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="199" y="307.7759">Vcx will do the message preparation and sending itself.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="203" y="322.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="199" y="337.6733">There is a problem with message forwarding:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="211" y="352.6221">Now DIDs must be used as target (`to` filed) according to Cross-Domain Messaging HIPE.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="527" x="199" y="367.5708">This problem is reflected in the issue: https://github.com/hyperledger/aries-rfcs/issues/255.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="199" y="382.5195">Lovesh's suggestion sounds acceptable to us.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="203" y="397.4683"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="505" x="199" y="412.417">So, we need to change on Agency is making support of messages forwarding based on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="215" y="427.3657">Alice Verkey's (in addition to DID's based).</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="589" x="199" y="442.3145">It should be easy to distinguish because fully-qualified DID's must be used for a new protocol version.</text><polygon fill="#A80036" points="1233,475.0693,1243,479.0693,1233,483.0693,1237,479.0693" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1059" x2="1239" y1="479.0693" y2="479.0693"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="1066" y="475.2632">Provision Alice</text><polygon fill="#A80036" points="2017,517.4412,2027,521.4412,2017,525.4412,2021,521.4412" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1679" x2="2023" y1="521.4412" y2="521.4412"/><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="2034,493.0181,2034,547.0181,2498,547.0181,2498,503.0181,2488,493.0181,2034,493.0181" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2488" x2="2488" y1="493.0181" y2="503.0181"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2498" x2="2488" y1="503.0181" y2="503.0181"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="443" x="2040" y="510.2119">In this diagram, we assume that Bob uses different Aries, compatible Agent.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338" x="2040" y="525.1606">He has published DIDDoc which is resolvable by Bob DID.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="2040" y="540.1094">Alice will send messages to Bob actor directly for simplification.</text><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2836" x="3" y="577.3386"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="577.3386" y2="577.3386"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="580.3386" y2="580.3386"/><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="76" x="1383" y="566.8643"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="1389" y="583.0581">Invitation</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="897" y1="634.2104" y2="634.2104"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="897" x2="897" y1="634.2104" y2="647.2104"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="856" x2="897" y1="647.2104" y2="647.2104"/><polygon fill="#A80036" points="866,643.2104,856,647.2104,866,651.2104,862,647.2104" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="862" y="629.4556">initiate connection establishment</text><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="419,604.813,419,658.813,846,658.813,846,614.813,836,604.813,419,604.813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="836" x2="836" y1="604.813" y2="614.813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="836" y1="614.813" y2="614.813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="347" x="425" y="622.0068">`vcx_connection_create` -&gt; create `Connection` state object</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="425" y="636.9556">`vcx_connection_connect` -&gt;  create Alice Pairwise Agent on Agency,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="367" x="457" y="651.9043">prepares `invite` message containing Alice DIDDoc and send it.</text><polygon fill="#A80036" points="1047,684.6592,1057,688.6592,1047,692.6592,1051,688.6592" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="1053" y1="688.6592" y2="688.6592"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="862" y="684.853">Create Alice Pairwise Agent</text><polygon fill="#A80036" points="1233,713.6079,1243,717.6079,1233,721.6079,1237,717.6079" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1059" x2="1239" y1="717.6079" y2="717.6079"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1066" y="713.8018">Create Alice Pairwise Agent</text><polygon fill="#A80036" points="1419,742.5566,1429,746.5566,1419,750.5566,1423,746.5566" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1245" x2="1425" y1="746.5566" y2="746.5566"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1252" y="742.7505">Create Alice Pairwise Agent</text><polygon fill="#A80036" points="866,771.5054,856,775.5054,866,779.5054,862,775.5054" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1430" y1="775.5054" y2="775.5054"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="872" y="771.6992">Alice Pairwise Agent Verkey</text><polygon fill="#A80036" points="1667,857.7747,1677,861.7747,1667,865.7747,1671,861.7747" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="1673" y1="861.7747" y2="861.7747"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="244" x="862" y="857.9685">Share plain `invitation` message with Bob.</text><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="337,789.4541,337,918.4541,846,918.4541,846,799.4541,836,789.4541,337,789.4541" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="836" x2="836" y1="789.4541" y2="799.4541"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="836" y1="799.4541" y2="799.4541"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="806.6479">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="472" x="359" y="821.5967">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/invitation",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="359" y="836.5454">"@id": "12345678900987654321",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="359" y="851.4941">"label": "Alice",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="359" y="866.4429">"recipientKeys": ["Alice Pairwise Verkey"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="359" y="881.3916">"serviceEndpoint": "https://example.com/endpoint",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="410" x="359" y="896.3403">"routingKeys": ["Alice Agency Verkey", "Alice Pairwise Agent Verkey"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="343" y="911.2891">}</text><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2836" x="3" y="948.5183"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="948.5183" y2="948.5183"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="951.5183" y2="951.5183"/><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="143" x="1349.5" y="938.0439"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="1355.5" y="954.2378">Connection Request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1679" x2="1721" y1="991.9414" y2="991.9414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1721" x2="1721" y1="991.9414" y2="1004.9414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1680" x2="1721" y1="1004.9414" y2="1004.9414"/><polygon fill="#A80036" points="1690,1000.9414,1680,1004.9414,1690,1008.9414,1686,1004.9414" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="336" x="1686" y="987.1865">process `invite` message and create `connection_request`</text><polygon fill="#A80036" points="1070,1078.7876,1060,1082.7876,1070,1086.7876,1066,1082.7876" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1064" x2="1678" y1="1082.7876" y2="1082.7876"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="1076" y="1078.9814">Send `encrypted_fwd_request` to `serviceEndpoint` taken from `invitation`</text><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="1684,1017.9414,1684,1131.9414,2149,1131.9414,2149,1027.9414,2139,1017.9414,1684,1017.9414" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2139" x2="2139" y1="1017.9414" y2="1027.9414"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2149" x2="2139" y1="1027.9414" y2="1027.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="444" x="1690" y="1035.1353">encrypted_fwd_request = &lt;pack(forward_message, "Alice Agency Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1694" y="1050.084"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="1690" y="1065.0327">forward_message = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="1698" y="1079.9814">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="1698" y="1094.9302">"to"   : "Alice Pairwise Agent Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="1698" y="1109.8789">"msg"  :  encrypted_forward_inner_message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1690" y="1124.8276">}</text><polygon fill="#A80036" points="1419,1157.5825,1429,1161.5825,1419,1165.5825,1423,1161.5825" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1059" x2="1425" y1="1161.5825" y2="1161.5825"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="1066" y="1157.7764">forward `encrypted_forward_inner_message`</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1431" x2="1473" y1="1227.3518" y2="1227.3518"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1473" x2="1473" y1="1227.3518" y2="1240.3518"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1432" x2="1473" y1="1240.3518" y2="1240.3518"/><polygon fill="#A80036" points="1442,1236.3518,1432,1240.3518,1442,1244.3518,1438,1240.3518" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="1481,1175.5313,1481,1289.5313,2091,1289.5313,2091,1185.5313,2081,1175.5313,1481,1175.5313" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2081" x2="2081" y1="1175.5313" y2="1185.5313"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2091" x2="2081" y1="1185.5313" y2="1185.5313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="589" x="1487" y="1192.7251">encrypted_forward_inner_message = &lt;pack(forward_inner_message, "Alice Pairwise Agent Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1491" y="1207.6738"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="1487" y="1222.6226">forward_inner_message = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="1495" y="1237.5713">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="1495" y="1252.52">"to"   : "Alice Pairwise Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1495" y="1267.4688">"msg"  :  encrypted_request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1487" y="1282.4175">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1431" x2="1473" y1="1320.1211" y2="1320.1211"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1473" x2="1473" y1="1320.1211" y2="1333.1211"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1432" x2="1473" y1="1333.1211" y2="1333.1211"/><polygon fill="#A80036" points="1442,1329.1211,1432,1333.1211,1442,1337.1211,1438,1333.1211" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="234" x="1438" y="1315.3662">stores `encrypted_request` in the queue.</text><polygon fill="#A80036" points="1419,1357.1211,1429,1361.1211,1419,1365.1211,1423,1361.1211" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="1425" y1="1361.1211" y2="1361.1211"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="390" x="862" y="1357.3149">`vcx_connection_update_state` all next steps are hidden in this call</text><polygon fill="#A80036" points="1419,1386.0698,1429,1390.0698,1419,1394.0698,1423,1390.0698" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="1425" y1="1390.0698" y2="1390.0698"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="862" y="1386.2637">get all messages {'status': 'Received'}</text><polygon fill="#A80036" points="866,1415.0186,856,1419.0186,866,1423.0186,862,1419.0186" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1430" y1="1419.0186" y2="1419.0186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="872" y="1415.2124">[ `encrypted_request` ]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="897" y1="1656.6982" y2="1656.6982"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="897" x2="897" y1="1656.6982" y2="1669.6982"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="856" x2="897" y1="1669.6982" y2="1669.6982"/><polygon fill="#A80036" points="866,1665.6982,856,1669.6982,866,1673.6982,862,1669.6982" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="173" x="862" y="1651.9434">decrypt and process `request`</text><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="8,1432.9673,8,1875.9673,846,1875.9673,846,1442.9673,836,1432.9673,8,1432.9673" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="836" x2="836" y1="1432.9673" y2="1442.9673"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="836" y1="1442.9673" y2="1442.9673"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="63" x="14" y="1450.1611">request = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="22" y="1465.1099">"@id": "5678876542345",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="463" x="22" y="1480.0586">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/request",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="22" y="1495.0073">"label": "Alice",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="22" y="1509.9561">"connection": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="170" x="30" y="1524.9048">"did": "Bob Pairwise Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="22" y="1539.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="46" y="1539.8535">"did_doc": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="38" y="1554.8022">"@context": "https://w3id.org/did/v1"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="38" y="1569.751">"id": "did:sov:1234abcd",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="38" y="1584.6997">"publicKey": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="650" x="46" y="1599.6484">{"id": "Bob Pairwise Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="696" y="1599.6484">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="700" y="1599.6484">BEGIN PUBLIC X…"},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="635" x="46" y="1614.5972">{"id": "Bob Agent Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="681" y="1614.5972">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="685" y="1614.5972">BEGIN PUBLIC A…"}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="38" y="1629.5459">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="38" y="1644.4946">"authentication": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459" x="46" y="1659.4434">{"type": "RsaSignatureAuthentication2018", "publicKey": "did:sov:1234abcd#4"}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="38" y="1674.3921">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="38" y="1689.3408">"service": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="46" y="1704.2896">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="54" y="1719.2383">"id": "did:example:123456789abcdefghi;did-communication",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="54" y="1734.187">"type": "did-communication",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="54" y="1749.1357">"priority" : 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="54" y="1764.0845">"recipientKeys" : [ "Bob Pairwise Verkey" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="54" y="1779.0332">"routingKeys" : [ "Bob Agent Verkey" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="425" x="54" y="1793.9819">"serviceEndpoint" : "did:example:xd45fr567794lrzti67;did-communication"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="46" y="1808.9307">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="38" y="1823.8794">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="30" y="1838.8281">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="22" y="1853.7769">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="14" y="1868.7256">}</text><polygon fill="#A80036" points="1419,1901.4805,1429,1905.4805,1419,1909.4805,1423,1905.4805" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="1425" y1="1905.4805" y2="1905.4805"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="862" y="1901.6743">update messages status</text><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2836" x="3" y="1934.9036"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="1934.9036" y2="1934.9036"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="1937.9036" y2="1937.9036"/><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="154" x="1344" y="1924.4292"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="1350" y="1940.623">Connection Response</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="897" y1="1969.3523" y2="1969.3523"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="897" x2="897" y1="1969.3523" y2="1982.3523"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="856" x2="897" y1="1982.3523" y2="1982.3523"/><polygon fill="#A80036" points="866,1978.3523,856,1982.3523,866,1986.3523,862,1982.3523" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="550,1962.3779,550,1986.3779,846,1986.3779,846,1972.3779,836,1962.3779,550,1962.3779" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="836" x2="836" y1="1962.3779" y2="1972.3779"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="836" y1="1972.3779" y2="1972.3779"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="275" x="556" y="1979.5718">Alice generates `connection_response` for Bob.</text><polygon fill="#A80036" points="1667,2062.1729,1677,2066.1729,1667,2070.1729,1671,2066.1729" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="1673" y1="2066.1729" y2="2066.1729"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="497" x="862" y="2062.3667">Send `encrypted_fwd_response` to `serviceEndpoint` taken from `connection_request`</text><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="387,2001.3267,387,2115.3267,846,2115.3267,846,2011.3267,836,2001.3267,387,2001.3267" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="836" x2="836" y1="2001.3267" y2="2011.3267"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="836" y1="2011.3267" y2="2011.3267"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="438" x="393" y="2018.5205">encrypted_fwd_response = &lt;pack(forward_message, "Bob Agent Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="397" y="2033.4692"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="393" y="2048.418">forward_message = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="401" y="2063.3667">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="401" y="2078.3154">"to"   : "Bob Pairwise Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="401" y="2093.2642">"msg"  :  encrypted_connection_response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="393" y="2108.2129">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1679" x2="1721" y1="2383.5962" y2="2383.5962"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1721" x2="1721" y1="2383.5962" y2="2396.5962"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1680" x2="1721" y1="2396.5962" y2="2396.5962"/><polygon fill="#A80036" points="1690,2392.5962,1680,2396.5962,1690,2400.5962,1686,2396.5962" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="249" x="1686" y="2378.8413">decrypts `encrypted_connection_response`</text><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="1947,2129.9678,1947,2632.9678,2825,2632.9678,2825,2139.9678,2815,2129.9678,1947,2129.9678" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2815" x2="2815" y1="2129.9678" y2="2139.9678"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2825" x2="2815" y1="2139.9678" y2="2139.9678"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="662" x="1953" y="2147.1616">encrypted_connection_response = &lt;pack(connection_response, "Bob Pairwise Verkey", "Alice Pairwise Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1957" y="2162.1104"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="1953" y="2177.0591">connection_response = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="1961" y="2192.0078">"@id": "5678876542345",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="473" x="1961" y="2206.9565">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/response",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="1961" y="2221.9053">"label": "Alice",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="1961" y="2236.854">"connection": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="1969" y="2251.8027">"did": "Alice Pairwise Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1961" y="2266.7515"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="1985" y="2266.7515">"did_doc": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1977" y="2281.7002">"@context": "https://w3id.org/did/v1"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1977" y="2296.6489">"@context": "https://w3id.org/did/v1"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="1977" y="2311.5977">"id": "did:sov:1234abcd",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="1977" y="2326.5464">"publicKey": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="656" x="1985" y="2341.4951">{"id": "Alice Pairwise Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="2641" y="2341.4951">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="2645" y="2341.4951">BEGIN PUBLIC X…"},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="651" x="1985" y="2356.4438">{"id": "Alice Agency Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="2636" y="2356.4438">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="2640" y="2356.4438">BEGIN PUBLIC 9…"},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="694" x="1985" y="2371.3926">{"id": "Alice Agent Pairwise Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="2679" y="2371.3926">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="2683" y="2371.3926">BEGIN PUBLIC A…"}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1977" y="2386.3413">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1977" y="2401.29">"authentication": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459" x="1985" y="2416.2388">{"type": "RsaSignatureAuthentication2018", "publicKey": "did:sov:1234abcd#4"}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="1977" y="2431.1875">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="1977" y="2446.1362">"service": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1985" y="2461.085">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="1993" y="2476.0337">"id": "did:example:123456789abcdefghi;did-communication",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="1993" y="2490.9824">"type": "did-communication",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="1993" y="2505.9312">"priority" : 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="1993" y="2520.8799">"recipientKeys" : [ "Alice Pairwise Verkey" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="1993" y="2535.8286">"routingKeys" : [ "Alice Agency Verkey", "Alice Pairwise Agent Verkey" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="1993" y="2550.7773">"serviceEndpoint" : "https://example.com/endpoint"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1985" y="2565.7261">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1977" y="2580.6748">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1969" y="2595.6235">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1961" y="2610.5723">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1953" y="2625.521">}</text><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2836" x="3" y="2662.7502"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="2662.7502" y2="2662.7502"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2839" y1="2665.7502" y2="2665.7502"/><rect fill="#EEEEEE" filter="url(#f96s0w8)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="41" x="1400.5" y="2652.2759"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="1406.5" y="2668.4697">Ack</text><polygon fill="#A80036" points="1070,2751.0708,1060,2755.0708,1070,2759.0708,1066,2755.0708" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1064" x2="1678" y1="2755.0708" y2="2755.0708"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="1076" y="2751.2646">sens `encrypted_fwd_response` for Alice</text><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="1684,2690.2246,1684,2804.2246,2159,2804.2246,2159,2700.2246,2149,2690.2246,1684,2690.2246" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2149" x2="2149" y1="2690.2246" y2="2700.2246"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2159" x2="2149" y1="2700.2246" y2="2700.2246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="454" x="1690" y="2707.4185">encrypted_fwd_response = &lt;pack(forward_message, "Alice Agency Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1694" y="2722.3672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="1690" y="2737.3159">forward_message = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="1698" y="2752.2646">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="1698" y="2767.2134">"to"   : "Alice Pairwise Agent Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="1698" y="2782.1621">"msg"  :  encrypted_forward_inner_message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1690" y="2797.1108">}</text><polygon fill="#A80036" points="1419,2829.8657,1429,2833.8657,1419,2837.8657,1423,2833.8657" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1059" x2="1425" y1="2833.8657" y2="2833.8657"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="1066" y="2830.0596">forward `encrypted_forward_inner_message`</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1431" x2="1473" y1="2899.635" y2="2899.635"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1473" x2="1473" y1="2899.635" y2="2912.635"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1432" x2="1473" y1="2912.635" y2="2912.635"/><polygon fill="#A80036" points="1442,2908.635,1432,2912.635,1442,2916.635,1438,2912.635" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="1481,2847.8145,1481,2961.8145,2091,2961.8145,2091,2857.8145,2081,2847.8145,1481,2847.8145" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2081" x2="2081" y1="2847.8145" y2="2857.8145"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2091" x2="2081" y1="2857.8145" y2="2857.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="589" x="1487" y="2865.0083">encrypted_forward_inner_message = &lt;pack(forward_inner_message, "Alice Pairwise Agent Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1491" y="2879.957"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="1487" y="2894.9058">forward_inner_message = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="1495" y="2909.8545">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="1495" y="2924.8032">"to"   : "Alice Pairwise Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="1495" y="2939.752">"msg"  :  encrypted_ack</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1487" y="2954.7007">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1431" x2="1473" y1="2992.4043" y2="2992.4043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1473" x2="1473" y1="2992.4043" y2="3005.4043"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1432" x2="1473" y1="3005.4043" y2="3005.4043"/><polygon fill="#A80036" points="1442,3001.4043,1432,3005.4043,1442,3009.4043,1438,3005.4043" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="1438" y="2987.6494">stores `encrypted_ack` in the queue.</text><polygon fill="#A80036" points="1419,3029.4043,1429,3033.4043,1419,3037.4043,1423,3033.4043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="1425" y1="3033.4043" y2="3033.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="390" x="862" y="3029.5981">`vcx_connection_update_state` all next steps are hidden in this call</text><polygon fill="#A80036" points="1419,3058.353,1429,3062.353,1419,3066.353,1423,3062.353" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="1425" y1="3062.353" y2="3062.353"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="862" y="3058.5469">get all messages {'status': 'Received'}</text><polygon fill="#A80036" points="866,3087.3018,856,3091.3018,866,3095.3018,862,3091.3018" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="860" x2="1430" y1="3091.3018" y2="3091.3018"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="109" x="872" y="3087.4956">[ `encrypted_ack` ]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="855" x2="897" y1="3186.9685" y2="3186.9685"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="897" x2="897" y1="3186.9685" y2="3199.9685"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="856" x2="897" y1="3199.9685" y2="3199.9685"/><polygon fill="#A80036" points="866,3195.9685,856,3199.9685,866,3203.9685,862,3199.9685" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="862" y="3182.2136">decrypt and process `ack`</text><polygon fill="#FBFB77" filter="url(#f96s0w8)" points="304,3105.2505,304,3264.2505,846,3264.2505,846,3115.2505,836,3105.2505,304,3105.2505" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="836" x2="836" y1="3105.2505" y2="3115.2505"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="846" x2="836" y1="3115.2505" y2="3115.2505"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="458" x="310" y="3122.4443">encrypted_ack = &lt;pack(ack, "Alice Pairwise Verkey", "Bob Pairwise Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="314" y="3137.3931"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="310" y="3152.3418">ack = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="431" x="326" y="3167.2905">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/notification/1.0/ack",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="326" y="3182.2393">"@id": "5678876542345",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="326" y="3197.188">"status": "OK",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="326" y="3212.1367">"~thread": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489" x="342" y="3227.0854">"thid": "&lt;The Thread ID is the Message ID (@id) of the first message in the thread&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="326" y="3242.0342">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="310" y="3256.9829">}</text></g></svg>