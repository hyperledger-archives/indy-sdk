<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="3151px" preserveAspectRatio="none" style="width:2424px;height:3151px;" version="1.1" viewBox="0 0 2424 3151" width="2424px" zoomAndPan="magnify"><defs><filter height="300%" id="fnf0og5" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="158" x="1132" y="23.1318">DID Exchange Protocol</text><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="895" x2="895" y1="68.1973" y2="3113.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1091.5" x2="1091.5" y1="68.1973" y2="3113.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1277.5" x2="1277.5" y1="68.1973" y2="3113.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1464" x2="1464" y1="68.1973" y2="3113.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1713.5" x2="1713.5" y1="68.1973" y2="3113.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1936" x2="1936" y1="68.1973" y2="3113.7891"/><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="871" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="878" y="53.2305">Alice</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="44" x="871" y="3112.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="30" x="878" y="3132.9209">Alice</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="1042.5" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1049.5" y="53.2305">Alice Agency</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="1042.5" y="3112.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="1049.5" y="3132.9209">Alice Agency</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="1233.5" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1240.5" y="53.2305">Alice Agent</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="85" x="1233.5" y="3112.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="71" x="1240.5" y="3132.9209">Alice Agent</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="1391" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1398" y="53.2305">Alice Pairwise Agent</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="1391" y="3112.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="1398" y="3132.9209">Alice Pairwise Agent</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="1692.5" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="1699.5" y="53.2305">Bob</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="39" x="1692.5" y="3112.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="25" x="1699.5" y="3132.9209">Bob</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="1894" y="33.0986"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1901" y="53.2305">Bob Agent</text><rect fill="#FEFECE" filter="url(#fnf0og5)" height="30.0986" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="1894" y="3112.7891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="1901" y="3132.9209">Bob Agent</text><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2416" x="3" y="98.6716"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="98.6716" y2="98.6716"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="101.6716" y2="101.6716"/><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="98" x="1162" y="88.1973"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="80" x="1168" y="104.3911">Provisioning</text><polygon fill="#A80036" points="1080,291.6333,1090,295.6333,1080,299.6333,1084,295.6333" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="895" x2="1086" y1="295.6333" y2="295.6333"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="902" y="291.8271">Provision Alice</text><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="233,126.146,233,449.146,886,449.146,886,136.146,876,126.146,233,126.146" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876" x2="876" y1="126.146" y2="136.146"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="886" x2="876" y1="136.146" y2="136.146"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="76" x="239" y="143.3398">Agency side:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="251" y="158.2886">We can keep the common workflow as is.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="395" x="251" y="173.2373">We still can create Pairwise Agents on the initiation of connection or</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="303" x="283" y="188.186">accepting an invitation but use it as a mediator only.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="251" y="203.1348">In the current state Pairwise Agents are already able</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="267" y="218.0835">- collect incoming messages</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="267" y="233.0322">- return collected messages</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="219" x="267" y="247.981">- update status of received messages</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="243" y="262.9297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="632" x="239" y="277.8784">The key difference is that we will not use Agency anymore for sending messages to another connection side,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="329" x="267" y="292.8271">so we don't need to keep other side keys on the Agency.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="239" y="307.7759">Vcx will do the message preparation and sending itself.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="243" y="322.7246"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="239" y="337.6733">There is a problem with message forwarding:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="522" x="251" y="352.6221">Now DIDs must be used as target (`to` filed) according to Cross-Domain Messaging HIPE.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="527" x="239" y="367.5708">This problem is reflected in the issue: https://github.com/hyperledger/aries-rfcs/issues/255.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="239" y="382.5195">Lovesh's suggestion sounds acceptable to us.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="243" y="397.4683"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="505" x="239" y="412.417">So, we need to change on Agency is making support of messages forwarding based on</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="247" x="255" y="427.3657">Alice Verkey's (in addition to DID's based).</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="589" x="239" y="442.3145">It should be easy to distinguish because fully-qualified DID's must be used for a new protocol version.</text><polygon fill="#A80036" points="1266,475.0693,1276,479.0693,1266,483.0693,1270,479.0693" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1092" x2="1272" y1="479.0693" y2="479.0693"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="1099" y="475.2632">Provision Alice</text><polygon fill="#A80036" points="1924,517.4412,1934,521.4412,1924,525.4412,1928,521.4412" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1714" x2="1930" y1="521.4412" y2="521.4412"/><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="1941,493.0181,1941,547.0181,2405,547.0181,2405,503.0181,2395,493.0181,1941,493.0181" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2395" x2="2395" y1="493.0181" y2="503.0181"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2405" x2="2395" y1="503.0181" y2="503.0181"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="443" x="1947" y="510.2119">In this diagram, we assume that Bob uses different Aries, compatible Agent.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338" x="1947" y="525.1606">He has published DIDDoc which is resolvable by Bob DID.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="371" x="1947" y="540.1094">Alice will send messages to Bob actor directly for simplification.</text><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2416" x="3" y="577.3386"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="577.3386" y2="577.3386"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="580.3386" y2="580.3386"/><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="76" x="1173" y="566.8643"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="1179" y="583.0581">Invitation</text><polygon fill="#A80036" points="906,710.5054,896,714.5054,906,718.5054,902,714.5054" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="900" x2="1713" y1="714.5054" y2="714.5054"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="250" x="912" y="710.6992">Share plain `invitation` message with Alice.</text><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="1719,604.813,1719,808.813,2228,808.813,2228,614.813,2218,604.813,1719,604.813" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2218" x2="2218" y1="604.813" y2="614.813"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2228" x2="2218" y1="614.813" y2="614.813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1725" y="622.0068">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="472" x="1741" y="636.9556">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/invitation",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="1741" y="651.9043">"@id": "12345678900987654321",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="1741" y="666.853">"label": "Bob",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="240" x="1741" y="681.8018">"recipientKeys": ["Bob Pairwise Verkey"],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="1741" y="696.7505">"serviceEndpoint": "https://example.com/endpoint",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="1741" y="711.6992">"routingKeys": ["Bob Agent Verkey"]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1725" y="726.6479">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1729" y="741.5967"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="340" x="1725" y="756.5454">In the current state, we can support this Invite format only.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="290" x="1725" y="771.4941">It contains all the information required for replying.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="441" x="1725" y="786.4429">There is no formalized way to resolve DIDDoc using VCX for the public DID.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="286" x="1725" y="801.3916">We need to provide the separate PoA/HIPE for it.</text><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2416" x="3" y="838.6208"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="838.6208" y2="838.6208"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="841.6208" y2="841.6208"/><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="143" x="1139.5" y="828.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="125" x="1145.5" y="844.3403">Connection Request</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="895" x2="937" y1="888.0183" y2="888.0183"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="937" x2="937" y1="888.0183" y2="901.0183"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="896" x2="937" y1="901.0183" y2="901.0183"/><polygon fill="#A80036" points="906,897.0183,896,901.0183,906,905.0183,902,901.0183" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="384,866.0952,384,920.0952,886,920.0952,886,876.0952,876,866.0952,384,866.0952" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876" x2="876" y1="866.0952" y2="876.0952"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="886" x2="876" y1="876.0952" y2="876.0952"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="419" x="390" y="883.2891">`vcx_connection_create_with_invite` -&gt; create `Connection` state object.</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="406" x="390" y="898.2378">`vcx_connection_connect` -&gt;  create Alice Pairwise Agent on Agency,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="449" x="422" y="913.1865">prepares `connection_request` message containing Alice DIDDoc and send it.</text><polygon fill="#A80036" points="1080,945.9414,1090,949.9414,1080,953.9414,1084,949.9414" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="895" x2="1086" y1="949.9414" y2="949.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="902" y="946.1353">Create Alice Pairwise Agent</text><polygon fill="#A80036" points="1266,974.8901,1276,978.8901,1266,982.8901,1270,978.8901" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1092" x2="1272" y1="978.8901" y2="978.8901"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1099" y="975.084">Create Alice Pairwise Agent</text><polygon fill="#A80036" points="1452,1003.8389,1462,1007.8389,1452,1011.8389,1456,1007.8389" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1278" x2="1458" y1="1007.8389" y2="1007.8389"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="162" x="1285" y="1004.0327">Create Alice Pairwise Agent</text><polygon fill="#A80036" points="906,1032.7876,896,1036.7876,906,1040.7876,902,1036.7876" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="900" x2="1463" y1="1036.7876" y2="1036.7876"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="165" x="912" y="1032.9814">Alice Pairwise Agent Verkey</text><polygon fill="#A80036" points="1702,1365.7109,1712,1369.7109,1702,1373.7109,1706,1369.7109" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="895" x2="1708" y1="1369.7109" y2="1369.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="902" y="1365.9048">send `encrypted_fwd_request` to `serviceEndpoint` taken from `invitation`</text><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="8,1050.7363,8,1672.7363,886,1672.7363,886,1060.7363,876,1050.7363,8,1050.7363" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876" x2="876" y1="1050.7363" y2="1060.7363"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="886" x2="876" y1="1060.7363" y2="1060.7363"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="14" y="1067.9302">encrypted_fwd_request = &lt;pack(forward_message, "Bob Agent Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="18" y="1082.8789"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="14" y="1097.8276">forward_message = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="432" x="22" y="1112.7764">"@type" : "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="22" y="1127.7251">"to"   : "Bob Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="22" y="1142.6738">"msg"  : encrypted_request</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="14" y="1157.6226">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="18" y="1172.5713"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="552" x="14" y="1187.52">encrypted_request = &lt;pack(connection_request, Bob Pairwise Verkey, Alice Pairwise Verkey)&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="18" y="1202.4688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="14" y="1217.4175">connection_request = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="22" y="1232.3662">"@id": "5678876542345",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="463" x="22" y="1247.3149">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/request",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="82" x="22" y="1262.2637">"label": "Bob",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="22" y="1277.2124">"connection": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="30" y="1292.1611">"did": "Alice Pairwise DID",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="22" y="1307.1099"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="46" y="1307.1099">"did_doc": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="38" y="1322.0586">"@context": "https://w3id.org/did/v1"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="38" y="1337.0073">"id": "did:sov:1234abcd",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="38" y="1351.9561">"publicKey": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="656" x="46" y="1366.9048">{"id": "Alice Pairwise Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="702" y="1366.9048">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="706" y="1366.9048">BEGIN PUBLIC X…"},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="651" x="46" y="1381.8535">{"id": "Alice Agency Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="697" y="1381.8535">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="701" y="1381.8535">BEGIN PUBLIC 9…"},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="694" x="46" y="1396.8022">{"id": "Alice Agent Pairwise Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="740" y="1396.8022">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="744" y="1396.8022">BEGIN PUBLIC A…"}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="38" y="1411.751">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="38" y="1426.6997">"authentication": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459" x="46" y="1441.6484">{"type": "RsaSignatureAuthentication2018", "publicKey": "did:sov:1234abcd#4"}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="38" y="1456.5972">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="38" y="1471.5459">"service": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="46" y="1486.4946">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="54" y="1501.4434">"id": "did:example:123456789abcdefghi;did-communication",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="54" y="1516.3921">"type": "did-communication",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="54" y="1531.3408">"priority" : 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="258" x="54" y="1546.2896">"recipientKeys" : [ "Alice Pairwise Verkey" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="426" x="54" y="1561.2383">"routingKeys" : [ "Alice Agency Verkey", "Alice Pairwise Agent Verkey" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="297" x="54" y="1576.187">"serviceEndpoint" : "https://example.com/endpoint"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="46" y="1591.1357">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="38" y="1606.0845">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="30" y="1621.0332">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="22" y="1635.9819">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="14" y="1650.9307">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="18" y="1665.8794"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1714" x2="1756" y1="1694.6086" y2="1694.6086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1756" x2="1756" y1="1694.6086" y2="1707.6086"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1715" x2="1756" y1="1707.6086" y2="1707.6086"/><polygon fill="#A80036" points="1725,1703.6086,1715,1707.6086,1725,1711.6086,1721,1707.6086" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="1764,1687.6343,1764,1711.6343,2264,1711.6343,2264,1697.6343,2254,1687.6343,1764,1687.6343" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2254" x2="2254" y1="1687.6343" y2="1697.6343"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2264" x2="2254" y1="1697.6343" y2="1697.6343"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="479" x="1770" y="1704.8281">Bob decrypts `connection_request` and generates `connection_response` for Alice.</text><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2416" x="3" y="1742.0574"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="1742.0574" y2="1742.0574"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="1745.0574" y2="1745.0574"/><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="154" x="1134" y="1731.583"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="136" x="1140" y="1747.7769">Connection Response</text><polygon fill="#A80036" points="1103,1830.3779,1093,1834.3779,1103,1838.3779,1099,1834.3779" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1097" x2="1713" y1="1834.3779" y2="1834.3779"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="497" x="1109" y="1830.5718">Send `encrypted_fwd_response` to `serviceEndpoint` taken from `connection_request`</text><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="1719,1769.5317,1719,1883.5317,2184,1883.5317,2184,1779.5317,2174,1769.5317,1719,1769.5317" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2174" x2="2174" y1="1769.5317" y2="1779.5317"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="2184" x2="2174" y1="1779.5317" y2="1779.5317"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="444" x="1725" y="1786.7256">encrypted_fwd_response = &lt;pack(forward_message, Alice Agency Verkey)&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1729" y="1801.6743"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="1725" y="1816.623">forward_message = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="1733" y="1831.5718">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="1733" y="1846.5205">"to"   : "Alice Pairwise Agent Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="1733" y="1861.4692">"msg"  :  encrypted_forward_inner_message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="1725" y="1876.418">}</text><polygon fill="#A80036" points="1452,1909.1729,1462,1913.1729,1452,1917.1729,1456,1913.1729" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1092" x2="1458" y1="1913.1729" y2="1913.1729"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="255" x="1099" y="1909.3667">forward `encrypted_forward_inner_message`</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1464" x2="1506" y1="1978.9421" y2="1978.9421"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1506" x2="1506" y1="1978.9421" y2="1991.9421"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1465" x2="1506" y1="1991.9421" y2="1991.9421"/><polygon fill="#A80036" points="1475,1987.9421,1465,1991.9421,1475,1995.9421,1471,1991.9421" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="845,1927.1216,845,2041.1216,1455,2041.1216,1455,1937.1216,1445,1927.1216,845,1927.1216" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1445" x2="1445" y1="1927.1216" y2="1937.1216"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1455" x2="1445" y1="1937.1216" y2="1937.1216"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="589" x="851" y="1944.3154">encrypted_forward_inner_message = &lt;pack(forward_inner_message, "Alice Pairwise Agent Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="855" y="1959.2642"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="157" x="851" y="1974.2129">forward_inner_message = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="428" x="859" y="1989.1616">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="182" x="859" y="2004.1104">"to"   : "Alice Pairwise Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="172" x="859" y="2019.0591">"msg"  :  encrypted_response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="851" y="2034.0078">}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1464" x2="1506" y1="2071.7114" y2="2071.7114"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1506" x2="1506" y1="2071.7114" y2="2084.7114"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1465" x2="1506" y1="2084.7114" y2="2084.7114"/><polygon fill="#A80036" points="1475,2080.7114,1465,2084.7114,1475,2088.7114,1471,2084.7114" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="1471" y="2066.9565">stores encrypted_response in the queue.</text><polygon fill="#A80036" points="1452,2108.7114,1462,2112.7114,1452,2116.7114,1456,2112.7114" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="895" x2="1458" y1="2112.7114" y2="2112.7114"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="390" x="902" y="2108.9053">`vcx_connection_update_state` all next steps are hidden in this call</text><polygon fill="#A80036" points="1452,2137.6602,1462,2141.6602,1452,2145.6602,1456,2141.6602" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="895" x2="1458" y1="2141.6602" y2="2141.6602"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="217" x="902" y="2137.854">get all messages {'status': 'Received'}</text><polygon fill="#A80036" points="906,2166.6089,896,2170.6089,906,2174.6089,902,2170.6089" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="900" x2="1463" y1="2170.6089" y2="2170.6089"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="912" y="2166.8027">[ encrypted_response ]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="895" x2="937" y1="2438.186" y2="2438.186"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="937" x2="937" y1="2438.186" y2="2451.186"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="896" x2="937" y1="2451.186" y2="2451.186"/><polygon fill="#A80036" points="906,2447.186,896,2451.186,906,2455.186,902,2451.186" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="902" y="2433.4312">decrypt and process `response`</text><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="48,2184.5576,48,2687.5576,886,2687.5576,886,2194.5576,876,2184.5576,48,2184.5576" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876" x2="876" y1="2184.5576" y2="2194.5576"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="886" x2="876" y1="2194.5576" y2="2194.5576"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="592" x="54" y="2201.7515">encrypted_response = &lt;pack(connection_response, "Alice Pairwise Verkey", "Bob Pairwise Verkey")&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="58" y="2216.7002"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="54" y="2231.6489">connection_response = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="473" x="62" y="2246.5977">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/didexchange/1.0/response",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="195" x="62" y="2261.5464">"@id": "12345678900987654321",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="62" y="2276.4951">"~thread": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489" x="70" y="2291.4438">"thid": "&lt;The Thread ID is the Message ID (@id) of the first message in the thread&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="62" y="2306.3926">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="62" y="2321.3413">"connection": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="70" y="2336.29">"did": "Bob Pairwise DID",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="62" y="2351.2388"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="67" x="86" y="2351.2388">"did_doc": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="212" x="78" y="2366.1875">"@context": "https://w3id.org/did/v1"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="78" y="2381.1362">"id": "did:sov:1234abcd",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="79" x="78" y="2396.085">"publicKey": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="650" x="86" y="2411.0337">{"id": "Bob Pairwise Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="736" y="2411.0337">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="131" x="740" y="2411.0337">BEGIN PUBLIC X…"},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="635" x="86" y="2425.9824">{"id": "Bob Agent Verkey", "type": "RsaVerificationKey2018",  "owner": "did:sov:1234abcd","publicKeyPem": "</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" text-decoration="line-through" textLength="4" x="721" y="2425.9824">-</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="725" y="2425.9824">BEGIN PUBLIC A…"}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="78" y="2440.9312">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="78" y="2455.8799">"authentication": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="459" x="86" y="2470.8286">{"type": "RsaSignatureAuthentication2018", "publicKey": "did:sov:1234abcd#4"}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="78" y="2485.7773">],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="78" y="2500.7261">"service": [</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="86" y="2515.6748">{</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="348" x="94" y="2530.6235">"id": "did:example:123456789abcdefghi;did-communication",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="94" y="2545.5723">"type": "did-communication",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="94" y="2560.521">"priority" : 0,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="252" x="94" y="2575.4697">"recipientKeys" : [ "Bob Pairwise Verkey" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="227" x="94" y="2590.4185">"routingKeys" : [ "Bob Agent Verkey" ],</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="425" x="94" y="2605.3672">"serviceEndpoint" : "did:example:xd45fr567794lrzti67;did-communication"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="86" y="2620.3159">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="78" y="2635.2646">]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="70" y="2650.2134">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="62" y="2665.1621">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="54" y="2680.1108">}</text><polygon fill="#A80036" points="1452,2712.8657,1462,2716.8657,1452,2720.8657,1456,2716.8657" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="895" x2="1458" y1="2716.8657" y2="2716.8657"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="902" y="2713.0596">update messages status</text><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2416" x="3" y="2746.2888"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="2746.2888" y2="2746.2888"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2419" y1="2749.2888" y2="2749.2888"/><rect fill="#EEEEEE" filter="url(#fnf0og5)" height="22.9487" style="stroke: #000000; stroke-width: 2.0;" width="41" x="1190.5" y="2735.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="23" x="1196.5" y="2752.0083">Ack</text><polygon fill="#A80036" points="1702,2916.8274,1712,2920.8274,1702,2924.8274,1706,2920.8274" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="895" x2="1708" y1="2920.8274" y2="2920.8274"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="181" x="902" y="2917.0212">`encrypted_fwd_ack` message.</text><polygon fill="#FBFB77" filter="url(#fnf0og5)" points="352,2773.7632,352,3052.7632,886,3052.7632,886,2783.7632,876,2773.7632,352,2773.7632" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="876" x2="876" y1="2773.7632" y2="2783.7632"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="886" x2="876" y1="2783.7632" y2="2783.7632"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="358" y="2790.957">forward_message = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="432" x="366" y="2805.9058">"@type" : "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/routing/1.0/forward",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="366" y="2820.8545">"to"   : "Bob Pairwise Verkey",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="366" y="2835.8032">"msg"  : encrypted_ack</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="358" y="2850.752">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="362" y="2865.7007"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="396" x="358" y="2880.6494">encrypted_fwd_ack = &lt;pack(forward_message, Bob Agent Verkey)&gt;</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="362" y="2895.5981"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="41" x="358" y="2910.5469">ack = {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="431" x="374" y="2925.4956">"@type": "did:sov:BzCbsNYhMrjHiqZDTUASHg;spec/notification/1.0/ack",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="146" x="374" y="2940.4443">"@id": "5678876542345",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="87" x="374" y="2955.3931">"status": "OK",</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="374" y="2970.3418">"~thread": {</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="489" x="382" y="2985.2905">"thid": "&lt;The Thread ID is the Message ID (@id) of the first message in the thread&gt;"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="374" y="3000.2393">},</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="366" y="3015.188">}</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="362" y="3030.1367"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="438" x="358" y="3045.0854">encrypted_ack = &lt;pack(ack, Bob Pairwise Verkey, Alice Pairwise Verkey)&gt;</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1714" x2="1756" y1="3082.7891" y2="3082.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1756" x2="1756" y1="3082.7891" y2="3095.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1715" x2="1756" y1="3095.7891" y2="3095.7891"/><polygon fill="#A80036" points="1725,3091.7891,1715,3095.7891,1725,3099.7891,1721,3095.7891" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="1721" y="3078.0342">decrypt and process `ack` message</text></g></svg>